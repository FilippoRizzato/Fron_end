<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Product Management</title>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h2 class="text-center">Gestione Prodotti</h2>
    <hr>
    <div class="text-center">
        <button type="button" class="btn btn-success" onclick="openCreateModal()">Crea</button>
    </div>
    <hr>
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Prezzo</th>
                <th>Marca</th>
                <th>Azione</th>
            </tr>
        </thead>
        <tbody id="productTable">
            <!-- Product data will be inserted here -->
        </tbody>
    </table>
</div>

<!-- Modal -->
<div class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Crea Nuovo Prodotto</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <div class="form-group">
                        <label for="productName">Nome Prodotto:</label>
                        <input type="text" class="form-control" id="productName" placeholder="Inserisci nome prodotto" required>
                    </div>
                    <div class="form-group">
                        <label for="productPrice">Prezzo Prodotto:</label>
                        <input type="number" class="form-control" id="productPrice" placeholder="Inserisci prezzo prodotto" required>
                    </div>
                    <div class="form-group">
                        <label for="productBrand">Marca Prodotto:</label>
                        <input type="text" class="form-control" id="productBrand" placeholder="Inserisci marca prodotto" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeCreateModal()">Chiudi</button>
                <button type="button" class="btn btn-primary" onclick="submitForm()">Salva</button>
            </div>
        </div>
    </div>
</div>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
function openCreateModal() {
    document.getElementById('createModal').style.display = 'block';
}

function closeCreateModal() {
    document.getElementById('createModal').style.display = 'none';
}

function submitForm() {
    var productName = document.getElementById('productName').value;
    var productPrice = document.getElementById('productPrice').value;
    var productBrand = document.getElementById('productBrand').value;

    var data = {
        data: {
            attributes: {
                nome: productName,
                prezzo: productPrice,
                marca: productBrand
            }
        }
    };

    fetch('/products', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        console.log('Prodotto aggiunto:', result);
        fetchProducts(); // Aggiorna la tabella dei prodotti dopo l'inserimento
        closeCreateModal(); // Chiudi il modal dopo l'inserimento
    })
    .catch(error => console.error('Errore aggiunta prodotto:', error));
}

function fetchProducts() {
    fetch('/products')
    .then(response => response.json())
    .then(data => {
        var productTable = document.getElementById('productTable');
        productTable.innerHTML = '';

        data.data.forEach(product => {
            var row = document.createElement('tr');
            row.innerHTML = `
                <td>${product.id}</td>
                <td>${product.attributes.nome}</td>
                <td>${product.attributes.prezzo}</td>
                <td>${product.attributes.marca}</td>
                <td>
                    <button class="btn btn-danger" onclick="deleteProduct(${product.id})">Elimina</button>
                    <button class="btn btn-primary" onclick="editProduct(${product.id})">Modifica</button>
                </td>
            `;
            productTable.appendChild(row);
        });
    })
    .catch(error => console.error('Errore recupero prodotti:', error));
}

function deleteProduct(productId) {
    fetch(`/products/${productId}`, {
        method: 'DELETE'
    })
    .then(response => {
        if (response.status === 204) {
            console.log('Prodotto eliminato con successo');
            fetchProducts();
        } else {
            throw new Error('Errore durante l\'eliminazione del prodotto');
        }
    })
    .catch(error => console.error('Errore eliminazione prodotto:', error));
}

function editProduct(productId) {
    // Placeholder per la funzione di modifica del prodotto
    console.log('Modifica prodotto:', productId);
}

// Esegui il fetch dei prodotti quando la pagina viene caricata
fetchProducts();
</script>
</body>
</html>
